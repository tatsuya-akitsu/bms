generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["jsonProtocol"]
}

datasource db {
  provider          = "postgresql"
  url               = env("POSTGRES_PRISMA_URL")
  directUrl         = env("POSTGRES_URL_NON_POOLING")
  shadowDatabaseUrl = env("POSTGRES_URL_NON_POOLING")
}

model User {
  id           Int                 @id @default(autoincrement())
  email        String              @unique
  characters   Character[]
  createdAt    DateTime @default(now())
}

model Character {
  id           Int                       @id @default(autoincrement())
  name         String
  label        String
  type         CharacterType
  attributes   CharacterAttributes
  totalScore   Int
  boost        Int
  characterTags CharacterToCharacterTag[]
  characterDetails CharacterDetail[]
  hasCharacter Boolean
  userId       Int
  user         User                     @relation(fields: [userId], references: [id])
  createdAt    DateTime                 @default(now())
}

model CharacterDetail {
  id            Int               @id @default(autoincrement())
  name          String
  label         String
  boost         Int
  attributes    CharacterAttributes
  type          CharacterType
  status        Json
  skill         Json
  property      Json
  characterTags CharacterToCharacterTag[]
  character      Character         @relation(fields: [id], references: [id])
  createdAt      DateTime          @default(now())
}

model CharacterTag {
  id           Int                       @id @default(autoincrement())
  name         String
  isActivation Boolean
  effect       Json
  characterTags CharacterToCharacterTag[]
  createdAt    DateTime                 @default(now())
}

// 中間テーブル（結合テーブル）
model CharacterToCharacterTag {
  character         Character                @relation(fields: [characterId], references: [id])
  characterDetail   CharacterDetail          @relation(fields: [characterDetailId], references: [id])
  characterId       Int
  characterDetailId Int
  tag               CharacterTag             @relation(fields: [tagId], references: [id])
  tagId             Int

  @@id([characterId, characterDetailId, tagId])
}

enum CharacterType {
  ATTACKER
  DEFENDER
  GETTER
}

enum CharacterAttributes {
  RED
  BLUE
  GREEN
}
